<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒ ì¸ì¦ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            background-color: #f8f9fa;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ“ EveryCourse í•™ìƒ ì¸ì¦ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- 0. ì‚¬ìš©ì ìƒì„± ì„¹ì…˜ (NEW!) -->
    <div class="section" style="background-color: #fff3cd;">
        <h2>0ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±</h2>
        <p><strong>ë¨¼ì € í…ŒìŠ¤íŠ¸í•  ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì„¸ìš”!</strong> (ì´ ë‹¨ê³„ê°€ createUserProfile íŠ¸ë¦¬ê±°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤)</p>
        <input type="text" id="newUserId" placeholder="ì‚¬ìš©ì ID (ì˜ˆ: test-user-1)" style="width: 200px;">
        <input type="email" id="newUserEmail" placeholder="ê¸°ë³¸ ì´ë©”ì¼ (ì˜ˆ: user@gmail.com)" style="width: 250px;">
        <input type="text" id="newUserName" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)" style="width: 150px;">
        <button onclick="createTestUser()" style="background-color: #28a745;">ì‚¬ìš©ì ìƒì„±</button>
        <div id="result0" class="result" style="display: none;"></div>
    </div>
    
    <!-- 1. í•™ìƒ ì¸ì¦ ì‹ ì²­ ì„¹ì…˜ -->
    <div class="section">
        <h2>1ï¸âƒ£ í•™ìƒ ì¸ì¦ ì‹ ì²­</h2>
        <p>ëŒ€í•™êµ ì´ë©”ì¼ë¡œ í•™ìƒ ì¸ì¦ì„ ì‹ ì²­í•©ë‹ˆë‹¤.</p>
        <input type="text" id="userId1" placeholder="ì‚¬ìš©ì ID (ì˜ˆ: user123)" style="width: 200px;">
        <input type="email" id="universityEmail" placeholder="ëŒ€í•™êµ ì´ë©”ì¼ (ì˜ˆ: student@snu.ac.kr)" style="width: 250px;">
        <button onclick="requestVerification()">ì¸ì¦ ì‹ ì²­</button>
        <div id="result1" class="result" style="display: none;"></div>
    </div>

    <!-- 2. ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ ì„¹ì…˜ -->
    <div class="section">
        <h2>2ï¸âƒ£ ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ</h2>
        <p>ì´ë©”ì¼ë¡œ ë°›ì€ ì¸ì¦ í† í°ì„ ì…ë ¥í•©ë‹ˆë‹¤.</p>
        <input type="text" id="userId2" placeholder="ì‚¬ìš©ì ID" style="width: 200px;">
        <input type="text" id="verificationToken" placeholder="ì¸ì¦ í† í°" style="width: 250px;">
        <button onclick="verifyEmail()">ì¸ì¦ ì™„ë£Œ</button>
        <div id="result2" class="result" style="display: none;"></div>
    </div>

    <!-- 3. í•™ìƒ ìƒíƒœ í™•ì¸ ì„¹ì…˜ -->
    <div class="section">
        <h2>3ï¸âƒ£ í•™ìƒ ìƒíƒœ í™•ì¸</h2>
        <p>í˜„ì¬ í•™ìƒ ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <input type="text" id="userId3" placeholder="ì‚¬ìš©ì ID" style="width: 200px;">
        <button onclick="checkStatus()">ìƒíƒœ í™•ì¸</button>
        <div id="result3" class="result" style="display: none;"></div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ -->
    <div class="section" style="background-color: #f0f8ff;">
        <h2>ğŸ“‹ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ</h2>
        <ol>
            <li><strong>ìœ íš¨í•œ ëŒ€í•™êµ ì´ë©”ì¼ í˜•ì‹:</strong>
                <ul>
                    <li>@snu.ac.kr (ì„œìš¸ëŒ€)</li>
                    <li>@yonsei.ac.kr (ì—°ì„¸ëŒ€)</li>
                    <li>@korea.ac.kr (ê³ ë ¤ëŒ€)</li>
                    <li>@kaist.ac.kr (ì¹´ì´ìŠ¤íŠ¸)</li>
                    <li>ë˜ëŠ” .ac.kr, .edu.kr, .eduë¡œ ëë‚˜ëŠ” ì´ë©”ì¼</li>
                </ul>
            </li>
            <li><strong>í…ŒìŠ¤íŠ¸ ìˆœì„œ:</strong> ì‚¬ìš©ì ìƒì„± â†’ ì¸ì¦ ì‹ ì²­ â†’ í† í° ì…ë ¥ â†’ ìƒíƒœ í™•ì¸</li>
            <li><strong>ì°¸ê³ :</strong> ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ì€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ, í† í°ì€ ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸í•˜ê±°ë‚˜ Firebase ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</li>
        </ol>
    </div>

    <script>
        const API_BASE_URL = 'https://us-central1-everycourse-911af.cloudfunctions.net';

        async function createTestUser() {
            const userId = document.getElementById('newUserId').value;
            const email = document.getElementById('newUserEmail').value;
            const displayName = document.getElementById('newUserName').value;
            const resultDiv = document.getElementById('result0');

            if (!userId || !email || !displayName) {
                showResult(resultDiv, 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/createTestUser`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId, email, displayName })
                });

                const result = await response.json();
                showResult(resultDiv, result.message, result.success);

                // ì„±ê³µí•˜ë©´ ë‹¤ë¥¸ í•„ë“œë“¤ë„ ìë™ìœ¼ë¡œ ì±„ì›€
                if (result.success) {
                    document.getElementById('userId1').value = userId;
                    document.getElementById('userId2').value = userId;
                    document.getElementById('userId3').value = userId;
                }

            } catch (error) {
                showResult(resultDiv, `ì˜¤ë¥˜: ${error.message}`, false);
            }
        }

        async function requestVerification() {
            const userId = document.getElementById('userId1').value;
            const universityEmail = document.getElementById('universityEmail').value;
            const resultDiv = document.getElementById('result1');

            if (!userId || !universityEmail) {
                showResult(resultDiv, 'ì‚¬ìš©ì IDì™€ ëŒ€í•™êµ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/requestStudentVerification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId, universityEmail })
                });

                const result = await response.json();
                showResult(resultDiv, result.message, result.success);

            } catch (error) {
                showResult(resultDiv, `ì˜¤ë¥˜: ${error.message}`, false);
            }
        }

        async function verifyEmail() {
            const userId = document.getElementById('userId2').value;
            const token = document.getElementById('verificationToken').value;
            const resultDiv = document.getElementById('result2');

            if (!userId || !token) {
                showResult(resultDiv, 'ì‚¬ìš©ì IDì™€ ì¸ì¦ í† í°ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/verifyStudentEmail`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId, token })
                });

                const result = await response.json();
                showResult(resultDiv, result.message, result.success);

            } catch (error) {
                showResult(resultDiv, `ì˜¤ë¥˜: ${error.message}`, false);
            }
        }

        async function checkStatus() {
            const userId = document.getElementById('userId3').value;
            const resultDiv = document.getElementById('result3');

            if (!userId) {
                showResult(resultDiv, 'ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/checkStudentStatus?userId=${encodeURIComponent(userId)}`);
                const result = await response.json();

                if (result.success) {
                    const message = result.isStudent 
                        ? 'âœ… í•™ìƒ ì¸ì¦ì´ ì™„ë£Œëœ ì‚¬ìš©ìì…ë‹ˆë‹¤!' 
                        : 'âŒ ì•„ì§ í•™ìƒ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    showResult(resultDiv, message, true);
                } else {
                    showResult(resultDiv, result.message, false);
                }

            } catch (error) {
                showResult(resultDiv, `ì˜¤ë¥˜: ${error.message}`, false);
            }
        }

        function showResult(element, message, isSuccess) {
            element.textContent = message;
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.style.display = 'block';
        }
    </script>
</body>
</html>
